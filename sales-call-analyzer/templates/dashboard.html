{% extends "base.html" %}

{% block title %}Dashboard - Sales Call Analyzer{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>Dashboard</h1>
        <a href="{{ url_for('upload') }}" class="btn btn-primary">
            <span>+</span> Upload New Call
        </a>
    </div>

    <!-- Summary Stats -->
    <div class="stats-grid">
        <div class="stat-card stat-card-primary">
            <div class="stat-icon">üìû</div>
            <div class="stat-content">
                <div class="stat-label">Total Calls</div>
                <div class="stat-value">{{ stats.total_calls }}</div>
            </div>
        </div>
        <div class="stat-card stat-card-success">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-content">
                <div class="stat-label">Completed</div>
                <div class="stat-value">{{ stats.completed_calls }}</div>
            </div>
        </div>
        <div class="stat-card stat-card-info">
            <div class="stat-icon">‚è±Ô∏è</div>
            <div class="stat-content">
                <div class="stat-label">Avg Duration</div>
                <div class="stat-value">{{ stats.avg_duration_min }} min</div>
            </div>
        </div>
        <div class="stat-card stat-card-warning">
            <div class="stat-icon">‚ùì</div>
            <div class="stat-content">
                <div class="stat-label">Avg Questions</div>
                <div class="stat-value">{{ stats.avg_questions }}</div>
            </div>
        </div>
    </div>

    <!-- Score Trends Chart -->
    {% if score_trends and score_trends.trend %}
    <div class="section">
        <div class="section-header">
            <h2>üìà Score Trends</h2>
        </div>
        <div class="chart-container">
            <canvas id="scoreTrendsChart"></canvas>
        </div>
    </div>
    {% endif %}

    <!-- Leaderboard and Team Benchmarks Row -->
    <div class="dashboard-row">
        <!-- Leaderboard -->
        {% if leaderboard %}
        <div class="section leaderboard-section">
            <div class="section-header">
                <h2>üèÜ Score Leaderboard</h2>
            </div>
            <div class="leaderboard">
                {% for rep in leaderboard %}
                <div class="leaderboard-item {% if loop.index <= 3 %}top-three{% endif %}">
                    <div class="rank">
                        {% if loop.index == 1 %}ü•á{% elif loop.index == 2 %}ü•à{% elif loop.index == 3 %}ü•â{% else %}{{ loop.index }}{% endif %}
                    </div>
                    <div class="rep-info">
                        <span class="rep-name">{{ rep.rep_name }}</span>
                        <span class="rep-stats">{{ rep.call_count }} calls</span>
                    </div>
                    <div class="rep-score {% if rep.avg_score >= 80 %}score-excellent{% elif rep.avg_score >= 60 %}score-good{% else %}score-fair{% endif %}">
                        {{ rep.avg_score }}
                        <div class="score-progress">
                            <div class="score-progress-fill" style="width: {{ rep.avg_score }}%"></div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% if score_trends and score_trends.improvement != 0 %}
            <div class="trend-indicator {% if score_trends.improvement > 0 %}positive{% else %}negative{% endif %}">
                {% if score_trends.improvement > 0 %}üìà{% else %}üìâ{% endif %}
                Team average {% if score_trends.improvement > 0 %}improved{% else %}declined{% endif %} by {{ score_trends.improvement|abs }} points
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Team Benchmarks -->
        {% if benchmarks and benchmarks.total_calls > 0 %}
        <div class="section benchmarks-section">
            <div class="section-header">
                <h2>üìä Team Benchmarks</h2>
            </div>
            <div class="benchmarks-grid">
                <div class="benchmark-item">
                    <div class="benchmark-label">Avg Duration</div>
                    <div class="benchmark-value">{{ benchmarks.avg_duration }} min</div>
                    <div class="benchmark-median">Median: {{ benchmarks.median_duration }} min</div>
                </div>
                <div class="benchmark-item">
                    <div class="benchmark-label">Avg Talk Ratio</div>
                    <div class="benchmark-value">{{ benchmarks.avg_talk_ratio }}%</div>
                    <div class="benchmark-median">Median: {{ benchmarks.median_talk_ratio }}%</div>
                </div>
                <div class="benchmark-item">
                    <div class="benchmark-label">Avg Questions</div>
                    <div class="benchmark-value">{{ benchmarks.avg_questions }}</div>
                    <div class="benchmark-median">{{ benchmarks.avg_questions_per_min }}/min</div>
                </div>
                <div class="benchmark-item">
                    <div class="benchmark-label">Avg Filler Words</div>
                    <div class="benchmark-value">{{ benchmarks.avg_filler_words }}</div>
                    <div class="benchmark-median">Per call</div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Recent Calls -->
    <div class="section">
        <div class="section-header">
            <h2>Recent Calls</h2>
            <a href="{{ url_for('history') }}" class="btn btn-sm btn-outline">View All</a>
        </div>

        {% if recent_calls %}
        <div class="calls-table">
            <table>
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Rep</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for call in recent_calls %}
                    <tr>
                        <td>
                            <div class="file-cell">
                                <span class="file-icon">üéôÔ∏è</span>
                                <span class="file-name">{{ call.filename }}</span>
                            </div>
                        </td>
                        <td>
                            {% if call.rep_name %}
                                <span class="rep-badge">{{ call.rep_name }}</span>
                            {% else %}
                                <span class="text-muted">‚Äî</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="status-badge status-{{ call.status }}">
                                {{ call.status }}
                            </span>
                        </td>
                        <td class="text-muted">
                            {{ call.created_at.strftime('%Y-%m-%d') if call.created_at else '‚Äî' }}
                        </td>
                        <td>
                            <div class="action-buttons">
                                {% if call.status == 'complete' %}
                                    <a href="{{ url_for('report', job_id=call.id) }}" class="btn-link">Report</a>
                                    <a href="{{ url_for('transcript', job_id=call.id) }}" class="btn-link">Transcript</a>
                                {% elif call.status == 'error' %}
                                    <span class="text-muted">Error</span>
                                {% else %}
                                    <a href="{{ url_for('process', job_id=call.id) }}" class="btn-link">Processing</a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üìû</div>
            <h3>No calls yet</h3>
            <p>Upload your first sales call to get started.</p>
            <a href="{{ url_for('upload') }}" class="btn btn-primary">Upload Call</a>
        </div>
        {% endif %}
    </div>

    <!-- Reps Summary -->
    {% if reps %}
    <div class="section">
        <div class="section-header">
            <h2>Reps</h2>
        </div>
        <div class="reps-list">
            {% for rep in reps %}
            <div class="rep-card">
                <span class="rep-name">{{ rep }}</span>
                <a href="{{ url_for('history', rep=rep) }}" class="btn-link">View Calls</a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<style>
.dashboard {
    max-width: 1200px;
    margin: 0 auto;
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
    animation: slideDown 0.4s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dashboard-header h1 {
    font-size: 32px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--text), var(--primary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
}

.stats-grid .stat-card {
    animation: fadeInUp 0.5s ease-out;
    animation-fill-mode: both;
}

.stats-grid .stat-card:nth-child(1) {
    animation-delay: 0.1s;
}

.stats-grid .stat-card:nth-child(2) {
    animation-delay: 0.2s;
}

.stats-grid .stat-card:nth-child(3) {
    animation-delay: 0.3s;
}

.stats-grid .stat-card:nth-child(4) {
    animation-delay: 0.4s;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.stat-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 16px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--border);
    transition: height 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.stat-card:hover::before {
    height: 4px;
}

.stat-icon {
    font-size: 36px;
    opacity: 0.8;
    transition: transform 0.3s ease;
}

.stat-card:hover .stat-icon {
    transform: scale(1.1);
}

.stat-content {
    flex: 1;
}

.stat-label {
    font-size: 13px;
    color: var(--text-muted);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--text);
    line-height: 1.2;
}

/* Stat Card Variants */
.stat-card-primary {
    background: linear-gradient(135deg, #e8f4fd 0%, #ffffff 100%);
    border-color: #b3d9ff;
}

.stat-card-primary::before {
    background: linear-gradient(90deg, #0f62fe, #4d9eff);
}

.stat-card-success {
    background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
    border-color: #a5d6a7;
}

.stat-card-success::before {
    background: linear-gradient(90deg, #24a148, #42be65);
}

.stat-card-info {
    background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
    border-color: #90caf9;
}

.stat-card-info::before {
    background: linear-gradient(90deg, #0f62fe, #4589ff);
}

.stat-card-warning {
    background: linear-gradient(135deg, #fff8e1 0%, #ffffff 100%);
    border-color: #ffcc80;
}

.stat-card-warning::before {
    background: linear-gradient(90deg, #f1c21b, #fdd13a);
}

.section {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: var(--shadow);
    transition: all 0.3s ease;
    animation: fadeIn 0.6s ease-out;
}

.section:hover {
    box-shadow: var(--shadow-lg);
    border-color: var(--primary);
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--border);
    transition: border-color 0.3s ease;
}

.section:hover .section-header {
    border-bottom-color: var(--primary);
}

.section-header h2 {
    font-size: 20px;
    font-weight: 600;
    transition: color 0.3s ease;
}

.section:hover .section-header h2 {
    color: var(--primary);
}

.calls-table {
    overflow-x: auto;
    border-radius: var(--radius);
}

.calls-table table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
}

.calls-table th {
    text-align: left;
    padding: 16px;
    font-size: 12px;
    font-weight: 700;
    color: var(--text-muted);
    background: var(--bg);
    border-bottom: 2px solid var(--border);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    position: sticky;
    top: 0;
    z-index: 10;
}

.calls-table th:first-child {
    border-radius: var(--radius) 0 0 0;
}

.calls-table th:last-child {
    border-radius: 0 var(--radius) 0 0;
}

.calls-table td {
    padding: 18px 16px;
    border-bottom: 1px solid var(--border);
    transition: background 0.2s ease;
}

.calls-table tbody tr {
    transition: all 0.2s ease;
}

.calls-table tbody tr:hover {
    background: var(--bg);
    transform: scale(1.01);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.calls-table tbody tr:last-child td {
    border-bottom: none;
}

.calls-table tbody tr:last-child td:first-child {
    border-radius: 0 0 0 var(--radius);
}

.calls-table tbody tr:last-child td:last-child {
    border-radius: 0 0 var(--radius) 0;
}

.file-cell {
    display: flex;
    align-items: center;
    gap: 12px;
}

.file-icon {
    font-size: 20px;
    transition: transform 0.2s ease;
}

.calls-table tbody tr:hover .file-icon {
    transform: scale(1.2);
}

.file-name {
    font-weight: 600;
    color: var(--text);
    transition: color 0.2s ease;
}

.calls-table tbody tr:hover .file-name {
    color: var(--primary);
}

.rep-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    background: linear-gradient(135deg, var(--bg), var(--card-bg));
    border: 1.5px solid var(--border);
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.2s ease;
}

.calls-table tbody tr:hover .rep-badge {
    border-color: var(--primary);
    background: linear-gradient(135deg, #e8f4fd, #ffffff);
    transform: scale(1.05);
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    text-transform: capitalize;
    letter-spacing: 0.3px;
    transition: all 0.2s ease;
}

.status-badge::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
}

.status-complete {
    background: linear-gradient(135deg, #d1f2eb, #a7f3d0);
    color: #0e7c5e;
    border: 1.5px solid #86efac;
}

.status-complete::before {
    background: #0e7c5e;
    box-shadow: 0 0 6px rgba(14, 124, 94, 0.4);
}

.status-pending,
.status-transcribing,
.status-analyzing,
.status-generating_pdf,
.status-sending_email,
.status-queued {
    background: linear-gradient(135deg, #fff3cd, #ffeaa7);
    color: #856404;
    border: 1.5px solid #fcd34d;
}

.status-pending::before,
.status-transcribing::before,
.status-analyzing::before,
.status-generating_pdf::before,
.status-sending_email::before,
.status-queued::before {
    background: #856404;
    animation: pulse-dot 1.5s ease-in-out infinite;
}

@keyframes pulse-dot {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(0.8); }
}

.status-error {
    background: linear-gradient(135deg, #f8d7da, #fecaca);
    color: #721c24;
    border: 1.5px solid #fca5a5;
}

.status-error::before {
    background: #721c24;
}

.action-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.btn-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    font-size: 13px;
    border-radius: var(--radius-sm);
    transition: all 0.2s ease;
    background: transparent;
    border: 1.5px solid transparent;
}

.btn-link:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(15, 98, 254, 0.3);
    text-decoration: none;
}

.btn-link::after {
    content: '‚Üí';
    transition: transform 0.2s ease;
}

.btn-link:hover::after {
    transform: translateX(2px);
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    animation: fadeIn 0.6s ease-out;
}

.empty-icon {
    font-size: 64px;
    margin-bottom: 16px;
    animation: bounce 2s ease-in-out infinite;
}

@keyframes bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

.empty-state h3 {
    font-size: 20px;
    margin-bottom: 8px;
    color: var(--text);
}

.empty-state p {
    color: var(--text-muted);
    margin-bottom: 24px;
    font-size: 15px;
}

.reps-list {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
}

.rep-card {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 18px;
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    transition: all 0.3s ease;
    cursor: pointer;
}

.rep-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
    border-color: var(--primary);
    background: linear-gradient(135deg, #e8f4fd, var(--bg));
}

.rep-name {
    font-weight: 600;
    color: var(--text);
    transition: color 0.3s ease;
}

.rep-card:hover .rep-name {
    color: var(--primary);
}

.rep-card .btn-link {
    transition: all 0.3s ease;
}

.rep-card:hover .btn-link {
    color: var(--primary);
    transform: translateX(4px);
}

.text-muted {
    color: var(--text-muted);
}

.benchmarks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.benchmark-item {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.benchmark-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--primary);
    transform: scaleY(0);
    transition: transform 0.3s ease;
}

.benchmark-item:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow);
    border-color: var(--primary);
}

.benchmark-item:hover::before {
    transform: scaleY(1);
}

.benchmark-label {
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.benchmark-value {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 6px;
    color: var(--text);
    transition: color 0.3s ease;
}

.benchmark-item:hover .benchmark-value {
    color: var(--primary);
}

.benchmark-median {
    font-size: 12px;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    gap: 6px;
}

.benchmark-median::before {
    content: 'üìä';
    font-size: 14px;
}

/* Dashboard Row for Side-by-Side Sections */
.dashboard-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    margin-bottom: 24px;
}

@media (max-width: 1024px) {
    .dashboard-row {
        grid-template-columns: 1fr;
    }
}

/* Leaderboard Styles */
.leaderboard-section {
    min-width: 0;
}

.leaderboard {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.leaderboard-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    transition: all 0.3s ease;
    position: relative;
}

.leaderboard-item:hover {
    transform: translateX(6px);
    box-shadow: var(--shadow);
    border-color: var(--primary);
}

.leaderboard-item.top-three {
    background: linear-gradient(135deg, #fff9e6 0%, #fffbf0 100%);
    border: 2px solid #fbbf24;
    box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2);
}

.leaderboard-item.top-three:hover {
    box-shadow: 0 4px 16px rgba(251, 191, 36, 0.3);
    transform: translateX(6px) translateY(-2px);
}

.leaderboard-item .rank {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 700;
    color: var(--text-muted);
    background: var(--card-bg);
    border-radius: 50%;
    flex-shrink: 0;
    border: 2px solid var(--border);
    transition: all 0.3s ease;
}

.leaderboard-item:hover .rank {
    border-color: var(--primary);
    background: var(--primary);
    color: white;
    transform: scale(1.1);
}

.leaderboard-item.top-three .rank {
    font-size: 24px;
    border-color: #fbbf24;
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: white;
    box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
}

.leaderboard-item.top-three:hover .rank {
    transform: scale(1.15) rotate(5deg);
}

.leaderboard-item .rep-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.leaderboard-item .rep-name {
    display: block;
    font-weight: 600;
    font-size: 15px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--text);
}

.leaderboard-item .rep-stats {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: var(--text-muted);
}

.leaderboard-item .rep-stats::before {
    content: 'üìä';
    font-size: 14px;
}

.leaderboard-item .rep-score {
    font-size: 24px;
    font-weight: 700;
    padding: 8px 16px;
    border-radius: var(--radius);
    min-width: 70px;
    text-align: center;
    position: relative;
    transition: all 0.3s ease;
}

.leaderboard-item:hover .rep-score {
    transform: scale(1.05);
}

.rep-score.score-excellent {
    background: linear-gradient(135deg, #dcfce7, #bbf7d0);
    color: #166534;
    border: 2px solid #86efac;
}

.rep-score.score-good {
    background: linear-gradient(135deg, #dbeafe, #bfdbfe);
    color: #1e40af;
    border: 2px solid #93c5fd;
}

.rep-score.score-fair {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    color: #92400e;
    border: 2px solid #fcd34d;
}

/* Score Progress Indicator */
.leaderboard-item .score-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    background: var(--border);
    border-radius: 0 0 var(--radius) var(--radius);
    overflow: hidden;
}

.leaderboard-item .score-progress-fill {
    height: 100%;
    transition: width 0.5s ease;
    border-radius: 0 0 var(--radius) var(--radius);
}

.leaderboard-item.top-three .score-progress-fill {
    background: linear-gradient(90deg, #fbbf24, #f59e0b);
}

.rep-score.score-excellent .score-progress-fill {
    background: linear-gradient(90deg, #86efac, #4ade80);
}

.rep-score.score-good .score-progress-fill {
    background: linear-gradient(90deg, #93c5fd, #60a5fa);
}

.rep-score.score-fair .score-progress-fill {
    background: linear-gradient(90deg, #fcd34d, #fbbf24);
}

.trend-indicator {
    margin-top: 16px;
    padding: 12px 18px;
    border-radius: var(--radius);
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s ease;
    animation: slideIn 0.5s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.trend-indicator.positive {
    background: linear-gradient(135deg, #dcfce7, #bbf7d0);
    color: #166534;
    border: 1.5px solid #86efac;
}

.trend-indicator.positive:hover {
    transform: scale(1.02);
    box-shadow: 0 2px 8px rgba(14, 124, 94, 0.2);
}

.trend-indicator.negative {
    background: linear-gradient(135deg, #fee2e2, #fecaca);
    color: #991b1b;
    border: 1.5px solid #fca5a5;
}

.trend-indicator.negative:hover {
    transform: scale(1.02);
    box-shadow: 0 2px 8px rgba(153, 27, 27, 0.2);
}

.benchmarks-section {
    min-width: 0;
}

/* Chart Container */
.chart-container {
    position: relative;
    height: 300px;
    margin-top: 16px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .chart-container {
        height: 250px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .stat-card {
        padding: 20px;
    }
    
    .stat-icon {
        font-size: 32px;
    }
    
    .stat-value {
        font-size: 28px;
    }
    
    .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
    
    .leaderboard-item {
        padding: 14px;
        gap: 12px;
    }
    
    .leaderboard-item .rank {
        width: 36px;
        height: 36px;
        font-size: 16px;
    }
    
    .calls-table {
        font-size: 14px;
    }
    
    .calls-table th,
    .calls-table td {
        padding: 12px 8px;
    }
    
    .action-buttons {
        flex-direction: column;
        gap: 6px;
    }
    
    .btn-link {
        width: 100%;
        justify-content: center;
    }
}
</style>

<script>
// Initialize Score Trends Chart
{% if score_trends and score_trends.trend %}
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('scoreTrendsChart');
    if (!ctx) return;
    
    const trendData = {{ score_trends.trend | tojson }};
    const labels = trendData.map(item => {
        // Format week label (e.g., "2024-W01" -> "Week 1, 2024")
        const [year, week] = item.week.split('-W');
        return `W${week}`;
    });
    const scores = trendData.map(item => item.avg_score);
    const counts = trendData.map(item => item.count);
    
    // Calculate average for reference line
    const avgScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Average Score',
                data: scores,
                borderColor: '#0f62fe',
                backgroundColor: 'rgba(15, 98, 254, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 5,
                pointHoverRadius: 7,
                pointBackgroundColor: '#0f62fe',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
            }, {
                label: 'Average',
                data: Array(scores.length).fill(avgScore),
                borderColor: '#667085',
                borderWidth: 2,
                borderDash: [5, 5],
                pointRadius: 0,
                fill: false,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 15,
                        font: {
                            size: 13,
                            weight: '500'
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: {
                        size: 14,
                        weight: '600'
                    },
                    bodyFont: {
                        size: 13
                    },
                    callbacks: {
                        afterLabel: function(context) {
                            const index = context.dataIndex;
                            return `Calls: ${counts[index]}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    min: Math.max(0, Math.min(...scores) - 10),
                    max: Math.min(100, Math.max(...scores) + 10),
                    ticks: {
                        font: {
                            size: 12
                        },
                        color: '#667085'
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    ticks: {
                        font: {
                            size: 12
                        },
                        color: '#667085'
                    },
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
});
{% endif %}
</script>
{% endblock %}

